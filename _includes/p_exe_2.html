<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
        }

        h2 {
            color: #007bff;
        }

        .solution-button {
            background-color: #007bff;
            color: #fff;
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            border-radius: 10px;
            margin: 10px;
            display: inline-block;
        }

        .solution-content {
            display: none;
            padding: 15px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            border-radius: 10px;
            margin: 10px;
        }

        pre {
            background-color: #0b0b0b;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h3>Step 1: Modify Your API to Accept Parameters</h3>
    <p>Now that you've created a basic API, let's enhance it by **handling dynamic user requests.**</p>

    <h4>1️⃣ Add support for fetching a single user by ID</h4>
    <p>Modify <code>app.py</code> to allow users to **retrieve a specific user by ID**:</p>
    <pre>
    from flask import Flask, request, jsonify

    app = Flask(__name__)

    users = [
        {"id": 1, "name": "Alice", "email": "alice@example.com"},
        {"id": 2, "name": "Bob", "email": "bob@example.com"}
    ]

    @app.route('/users', methods=['GET'])
    def get_users():
        return jsonify(users)

    @app.route('/users/<int:user_id>', methods=['GET'])
    def get_user(user_id):
        user = next((u for u in users if u["id"] == user_id), None)
        if user:
            return jsonify(user)
        return jsonify({"error": "User not found"}), 404

    if __name__ == '__main__':
        app.run(debug=True)
    </pre>

    <h4>2️⃣ Test it in Postman</h4>
    <p>Make a **GET request** to fetch user **ID 1**:</p>
    <pre>
    http://127.0.0.1:5000/users/1
    </pre>

    <p>If successful, you should receive:</p>
    <pre>
    {
        "id": 1,
        "name": "Alice",
        "email": "alice@example.com"
    }
    </pre>

    <h3>Step 2: Implement Query Parameters</h3>
    <p>Let’s allow users to **filter the list of users by name**.</p>

    <h4>1️⃣ Modify <code>app.py</code></h4>
    <pre>
    @app.route('/users', methods=['GET'])
    def get_users():
        name_filter = request.args.get('name')
        if name_filter:
            filtered_users = [u for u in users if name_filter.lower() in u["name"].lower()]
            return jsonify(filtered_users)
        return jsonify(users)
    </pre>

    <h4>2️⃣ Test it in Postman</h4>
    <p>Make a **GET request** to search for users with "Alice" in their name:</p>
    <pre>
    http://127.0.0.1:5000/users?name=alice
    </pre>

    <h3>Step 3: Add Basic Authentication (API Key)</h3>
    <p>We’ll now add an **API key** requirement for making requests.</p>

    <h4>1️⃣ Modify <code>app.py</code> to require an API key</h4>
    <pre>
    API_KEY = "mysecretapikey"

    def check_api_key():
        key = request.headers.get("x-api-key")
        if key != API_KEY:
            return jsonify({"error": "Unauthorized"}), 403

    @app.route('/users', methods=['GET'])
    def get_users():
        auth = check_api_key()
        if auth:
            return auth  # Returns 403 error if key is incorrect
        return jsonify(users)
    </pre>

    <h4>2️⃣ Test it in Postman</h4>
    <p>Send a **GET request** with the required API key:</p>
    <pre>
    Headers:
    x-api-key: mysecretapikey
    </pre>

    <p>If the API key is missing, you'll get:</p>
    <pre>
    {
        "error": "Unauthorized"
    }
    </pre>

    <h3>Step 4: Add Logging for Debugging</h3>
    <p>We’ll now **log all incoming API requests** for easier debugging.</p>

    <h4>1️⃣ Modify <code>app.py</code> to log requests</h4>
    <pre>
    import logging

    logging.basicConfig(level=logging.INFO)

    @app.before_request
    def log_request():
        logging.info(f"Incoming request: {request.method} {request.url}")
    </pre>

    <h4>2️⃣ Run your API and make requests</h4>
    <p>Check your **VS Code terminal** to see logs in real-time.</p>

    <h3>Step 5: Document the API</h3>
    <p>Now that you've built a **more advanced API**, document the following:</p>
    <ul>
        <li>API Overview</li>
        <li>Endpoints (GET /users, GET /users/{id})</li>
        <li>Query Parameters</li>
        <li>Authentication (API Key)</li>
        <li>Request & Response Formats</li>
        <li>Status Codes</li>
    </ul>

    <button class="solution-button" onclick="toggleSolution('solution2')">Solution: API Documentation</button>

    <!-- Solution to Documentation -->
    <div class="solution-content" id="solution2">
        <h3>Solution: API Documentation</h3>

        <h4>1. Overview</h4>
        <p>This API allows users to **retrieve a list of users**, **search by name**, and **fetch user details by ID**.</p>

        <h4>2. Endpoints</h4>
        <table>
            <tr>
                <th>Method</th>
                <th>Endpoint</th>
                <th>Description</th>
            </tr>
            <tr>
                <td>GET</td>
                <td>/users</td>
                <td>Retrieve all users or filter by name.</td>
            </tr>
            <tr>
                <td>GET</td>
                <td>/users/{id}</td>
                <td>Retrieve details of a specific user.</td>
            </tr>
        </table>

        <h4>3. Authentication</h4>
        <p>All requests must include a valid API key in the **x-api-key** header.</p>

        <h4>4. Status Codes</h4>
        <table>
            <tr>
                <th>Code</th>
                <th>Description</th>
            </tr>
            <tr>
                <td>200</td>
                <td>OK - Successful request.</td>
            </tr>
            <tr>
                <td>403</td>
                <td>Unauthorized - API key missing or invalid.</td>
            </tr>
            <tr>
                <td>404</td>
                <td>Not Found - User ID does not exist.</td>
            </tr>
        </table>
    </div>

    <script>
        function toggleSolution(solutionId) {
            var solution = document.getElementById(solutionId);
            solution.style.display = solution.style.display === "block" ? "none" : "block";
        }
    </script>

</body>
</html>
